(function(a){a.fn.FFI_BE_Reload_Index=function(b){a.extend(a.fn.FFI_BE_Reload_Index,b);a.fn.FFI_BE_Reload_Index.button=a(this);a.fn.FFI_BE_Reload_Index.indexed=0;a.fn.FFI_BE_Reload_Index.indicator=a(a.fn.FFI_BE_Reload_Index.defaults.progressIndicator);return a.fn.FFI_BE_Reload_Index.button.click(function(d){a.fn.FFI_BE_Reload_Index.button.attr("disabled","disabled");d.preventDefault();d.stopPropagation();var c=confirm("WARNING: This is a dangerous operation. All of the data in the remote IndexDen database, which is used for searching for books, will be deleted and reloaded with a new set of data from the local database.\n\nDuring this process, the Book Exchange's searching mechanism will be unavailable. This process may take several minutes to complete. It is recommended that you wait until the website traffic has slowed down to minimize user impact. Do you wish to continue?");if(c){alert("The reloading process will now start.\n\nIMPORTANT: Do NOT leave this page until you are told that this process has completed successfully. Leaving this page will cause the process to stop and will result in a corrupt IndexDen database.");a.fn.FFI_BE_Reload_Index.indexed=0;a.fn.FFI_BE_Reload_Index.indicator.text("Indexed so far: 0 books");a.fn.FFI_BE_Reload_Index.reload()}else{a.fn.FFI_BE_Reload_Index.button.removeAttr("disabled")}})};a.fn.FFI_BE_Reload_Index.reload=function(){a.ajax({type:"GET",url:a.fn.FFI_BE_Reload_Index.defaults.processor,success:function(d){var g;try{g=a.parseJSON(d)}catch(f){alert(f)}var b=g.completed;var c=parseInt(g.indexed);a.fn.FFI_BE_Reload_Index.indexed+=c;if(!b){a.fn.FFI_BE_Reload_Index.reload();a.fn.FFI_BE_Reload_Index.indicator.text("Indexed so far: "+a.fn.FFI_BE_Reload_Index.indexed+(a.fn.FFI_BE_Reload_Index.indexed==1?" book":" books"))}else{a.fn.FFI_BE_Reload_Index.indicator.text("Indexed so far: "+a.fn.FFI_BE_Reload_Index.indexed+" of "+a.fn.FFI_BE_Reload_Index.indexed+(a.fn.FFI_BE_Reload_Index.indexed==1?" book":" books"));a.fn.FFI_BE_Reload_Index.validate()}}})};a.fn.FFI_BE_Reload_Index.validate=function(){setTimeout(function(){a.fn.FFI_BE_Reload_Index.indicator.text("Validating data integrity...");a.ajax({type:"GET",url:a.fn.FFI_BE_Reload_Index.defaults.validator,success:function(b){if(parseInt(b)==a.fn.FFI_BE_Reload_Index.indexed){a.fn.FFI_BE_Reload_Index.button.removeAttr("disabled");a.fn.FFI_BE_Reload_Index.indicator.text("");alert("The IndexDen index has been successfully reloaded. The searching mechanism is now functional again.\n\nYou may now leave this page.")}else{a.fn.FFI_BE_Reload_Index.indexed=0;a.fn.FFI_BE_Reload_Index.reload()}}})},a.fn.FFI_BE_Reload_Index.defaults.validationWait)};a.fn.FFI_BE_Reload_Index.defaults={processor:document.location.href.substring(0,document.location.href.indexOf("wp-admin"))+"wp-content/plugins/book-exchange/admin/processing/reload.php",progressIndicator:"p.reload-progress",validator:document.location.href.substring(0,document.location.href.indexOf("wp-admin"))+"wp-content/plugins/book-exchange/admin/processing/size.php",validationWait:3000}})(jQuery);(function(a){a(function(){a("button.reload-index").FFI_BE_Reload_Index()})})(jQuery);(function(a){a.FFI_BE_Approve=function(b){a.extend(a.FFI_BE_Approve.defaults,b);a.FFI_BE_Approve.approve=a("button.approve");a.FFI_BE_Approve.inappropriate=a("button.inappropriate");a.FFI_BE_Approve.unavailable=a("button.unavailable");a.FFI_BE_Approve.altURL=a("input.alternative-url-input");a.FFI_BE_Approve.altBtn=a("button.alternative-url");a.FFI_BE_Approve.approve.click(function(c){a.FFI_BE_Approve.approveHandler(c)});a.FFI_BE_Approve.inappropriate.click(function(c){a.FFI_BE_Approve.inappropriateHandler(c)});a.FFI_BE_Approve.unavailable.click(function(c){a.FFI_BE_Approve.unavailableHandler(c)});a.FFI_BE_Approve.altURL.change(function(c){a.FFI_BE_Approve.altURLHandler(c)});a.FFI_BE_Approve.altBtn.click(function(c){a.FFI_BE_Approve.altBtnHandler(c)});a(document).mousemove(function(c){a.FFI_BE_Approve.mouseX=c.pageX;a.FFI_BE_Approve.mouseY=c.pageY})};a.FFI_BE_Approve.approveHandler=function(c){var b=a(c.target);a.FFI_BE_Approve.disableSiblings(b);a.ajax({data:{ID:b.attr("data-id"),state:"approved"},type:"POST",url:a.FFI_BE_Approve.defaults.processor,success:function(d){if(d=="success"){b.text("Applied!");a.FFI_BE_Approve.whoot("Cover has been approved!")}else{b.text("Approve");a.FFI_BE_Approve.enableSiblings(b);alert("There was a problem while attempting to apply the book cover.\n\n"+d)}}})};a.FFI_BE_Approve.inappropriateHandler=function(c){var b=a(c.target);a.FFI_BE_Approve.disableSiblings(b);a.FFI_BE_Approve.changePreview(b,a.FFI_BE_Approve.defaults.inappropriateURL);a.ajax({data:{ID:b.attr("data-id"),state:"inappropriate"},type:"POST",url:a.FFI_BE_Approve.defaults.processor,success:function(d){if(d=="success"){b.text("Applied!");a.FFI_BE_Approve.whoot("The new cover has been applied")}else{b.text("Inappropriate");a.FFI_BE_Approve.enableSiblings(b);alert("There was a problem while attempting to apply the book cover.\n\n"+d)}}})};a.FFI_BE_Approve.unavailableHandler=function(c){var b=a(c.target);a.FFI_BE_Approve.disableSiblings(b);a.FFI_BE_Approve.changePreview(b,a.FFI_BE_Approve.defaults.unavailableURL);a.ajax({data:{ID:b.attr("data-id"),state:"unavailable"},type:"POST",url:a.FFI_BE_Approve.defaults.processor,success:function(d){if(d=="success"){b.text("Applied!");a.FFI_BE_Approve.whoot("The new cover has been applied")}else{b.text("Unavailable");a.FFI_BE_Approve.enableSiblings(b);alert("There was a problem while attempting to apply the book cover.\n\n"+d)}}})};a.FFI_BE_Approve.altURLHandler=function(d){var c=a(d.target);var b=c.siblings("button");if(c.val()!=""&&a.FFI_BE_Approve.URLValid(c.val())){a.FFI_BE_Approve.changePreview(c,c.val());b.removeAttr("disabled")}else{a.FFI_BE_Approve.changePreview(c,"");b.attr("disabled","disabled")}};a.FFI_BE_Approve.altBtnHandler=function(d){var c=a(d.target);var b=c.siblings("input").val();if(!a.FFI_BE_Approve.URLValid(b)){return}a.FFI_BE_Approve.disableSiblings(c);a.ajax({data:{ID:c.attr("data-id"),state:"approved",URL:b},type:"POST",url:a.FFI_BE_Approve.defaults.processor,success:function(e){if(e=="success"){c.text("Applied!");a.FFI_BE_Approve.whoot("The new cover has been applied")}else{c.text("Unavailable");a.FFI_BE_Approve.enableSiblings(c);alert("There was a problem while attempting to apply the book cover.\n\n"+e)}}})};a.FFI_BE_Approve.disableSiblings=function(b){b.attr("disabled","disabled").text("Please wait...");b.parent().parent().find("p input, p button").attr("disabled","disabled")};a.FFI_BE_Approve.enableSiblings=function(b){b.parent().parent().find("p input, p button").removeAttr("disabled")};a.FFI_BE_Approve.changePreview=function(c,d){var b=c.parent().parent().find("img");if(d!=""){b.attr("data-old-url",b.attr("src"));b.attr("src",d)}else{b.attr("src",b.attr("data-old-url"))}};a.FFI_BE_Approve.URLValid=function(b){return/^([a-z]([a-z]|\d|\+|-|\.)*):(\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?((\[(|(v[\da-f]{1,}\.(([a-z]|\d|-|\.|_|~)|[!\$&'\(\)\*\+,;=]|:)+))\])|((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=])*)(:\d*)?)(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*|(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)){0})(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(b)};a.FFI_BE_Approve.whoot=function(c){var b=a("<span />").text(c).css({background:"#00FF66",border:"1px solid #003300","border-radius":"5px",color:"#000000","font-size":"13px","font-weight":"bolder",left:a.FFI_BE_Approve.mouseX+20+"px",padding:"2px 5px 2px 5px",position:"absolute","text-align":"center",top:a.FFI_BE_Approve.mouseY-20+"px"}).appendTo("body");b.animate({opacity:0,top:"-=100"},a.FFI_BE_Approve.defaults.toolTipDuration,"linear",function(){b.remove()})};a.FFI_BE_Approve.defaults={processor:document.location.href.substring(0,document.location.href.indexOf("wp-admin"))+"wp-content/plugins/book-exchange/admin/processing/approve.php",inappropriateURL:document.location.href.substring(0,document.location.href.indexOf("wp-admin"))+"wp-content/plugins/book-exchange/app/system/images/book-covers/inappropriate-preview.jpg",toolTipDuration:5000,unavailableURL:document.location.href.substring(0,document.location.href.indexOf("wp-admin"))+"wp-content/plugins/book-exchange/app/system/images/book-covers/unavailable-preview.jpg"}})(jQuery);(function(a){a(function(){a.FFI_BE_Approve()})})(jQuery);
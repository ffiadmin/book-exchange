(function(a){a(document).ready(function(){var i=new Array();var e=0;var f,h,k;var c=a("div.imageContainer");var b=a("input.imageURL");var n=a("span.back");var l=a("span.forward");var g="AIzaSyCCfXsNv47Xg62-Kz6opyvmn3YBPhliZ0k";var d="https://www.googleapis.com/shopping/search/v1/public/products?country=US&key="+g+"&q=";var m=document.location.href;var j=m.substring(0,m.indexOf("book-exchange"))+"wp-content/plugins/book-exchange/app/system/server/suggest_local.php?ISBN=";a("input.ISBN").change(function(){var o=a(this);var p=o.val().replace(/[^0-9a-zA-Z]/g,"");if(p.length==10||p.length==13){a.ajax({url:j+p,success:function(t){a("input.imageID").attr("value","");if(t.toString()!="failure"){t=a.parseJSON(t);var s='<span class="editionInfo"></span>';if(t.edition!=""){s='<span class="editionInfo"><strong>Edition:</strong> '+t.edition+"</span>"}var r="";for(var q=0;q<=t.classes.length-1;q++){r+='<span class="class"><span class="band" style="border-left-color: '+t.classes[q].color+';"><span class="icon" style="background-image: url(\'../wp-content/plugins/book-exchange/app/system/images/categories/'+t.classes[q].id+"/icon_032.png');\">"+t.classes[q].name+" "+t.classes[q].classNum+" "+t.classes[q].section+"</span></span></span>"}f=a('<section class="dialog suggestions"><h1>We Already Have this Book On Record</h1><div class="content"><div class="imagePreview"><p>Verify that the suggested book cover is correct:</p><img src="'+t.imageURL+'"><span class="imageID" style="display: none;"">'+t.imageID+'</span></div><div class="bookInfo"><p>Check the title, author, and edition (if available):</p><span class="titleInfo"><strong>Title:</strong> '+t.title+'</span><span class="authorInfo"><strong>Author:</strong> '+t.author+"</span>"+s+'</div><div class="classInfo"><p><span class="highlight">Click on the classes</span> where you used this book (you can add more later):</p>'+r+'</div></div><div class="buttons"><button class="green accurate">This Information Is Accurate</button><button class="red inAccurate">This Information Is Not Accurate</button></div></section>').appendTo("body").delfini_dialog();a("div.imageBrowser").addClass("hidden")}else{c.text("Guessing...");i=new Array();n.addClass("disabled");l.removeClass("disabled");a.ajax({url:d+p,dataType:"jsonp",success:function(x){var w=x.items;e=0;if(w&&w!=undefined){for(var v=0;v<=w.length-1;v++){if(w[v].product.images&&w[v].product.images!=undefined){i.push(w[v].product.images[0].link)}}}if((!w&&w==undefined)||(w&&w!=undefined&&w.length==0)){var u=document.location.href.toString().match(/(.*)\/sell-books\//)[1]+"/system/images/icons/default_book.png";c.html('<img src="'+u+'" />');a("input.imageURL").attr("value",u);a("div.imageBrowser").addClass("hidden");k=a('<section class="dialog checkISBN" style="margin: 0px 30% 0px 30%; width: 40%;"><h1>Whoops!</h1><div class="content"><p style="font-size: 16px; margin-top: 5px;">We were unable to find a cover to match the ISBN you entered. This is usually because it was entered incorrectly. Check it again to see if you typed it in correctly.<br><br>If you did enter it in correctly, this may be a rare case where we cannot match the ISBN to a book cover.</p></div><div class="buttons"><button class="blue close">Ok, thanks</button></div></section>').appendTo("body").delfini_dialog()}else{c.html('<img src="'+i[0]+'" />');a("input.imageURL").attr("value",i[0]);if(w.length==1){l.addClass("disabled")}a("div.imageBrowser").removeClass("hidden");if(i.length>1){setTimeout(function(){a("div.imageBrowser span.forward").validationEngine("showPrompt","Click on these arrows to browse through the images and find the best looking cover!","pass","topRight",true)},4000)}}}})}}})}else{if(p!=""){k=a('<section class="dialog checkISBN" style="margin: 0px 30% 0px 30%; width: 40%;"><h1>Whoops!</h1><div class="content"><p style="font-size: 16px; margin-top: 5px;"><strong>'+o.val()+'</strong> doesn\'t look like an ISBN. Check it again to see if you entered it correctly.</p></div><div class="buttons"><button class="blue close">Ok, thanks</button></div></section>').appendTo("body").delfini_dialog()}}});a("body").delegate("section.checkISBN div.buttons button.close","click",function(){a(this).parent().parent().delfini_dialog("close")});a("body").delegate("section.dialog div.content div.classInfo span.class","click",function(){var o=a(this);if(o.hasClass("selected")){o.removeClass("selected")}else{o.addClass("selected")}});a("body").delegate("section.dialog div.buttons button.accurate","click",function(){var A=a(this).parent().parent();var r=A.children("div.content").children("div.classInfo").children("span.class.selected");var q=A.children("div.content").children("div.imagePreview").children("img").attr("src");var y=A.children("div.content").children("div.imagePreview").children("span.imageID").text();var C=A.children("div.content").children("div.bookInfo").children("span.titleInfo").text();var z=A.children("div.content").children("div.bookInfo").children("span.authorInfo").html();var v=A.children("div.content").children("div.bookInfo").children("span.authorInfo").text();var p=A.children("div.content").children("div.bookInfo").children("span.editionInfo").html();var o=A.children("div.content").children("div.bookInfo").children("span.editionInfo").text();a("input.titleInput").val(C.substring(7,C.length));a("input.authorInput").val(v.substring(8,v.length));a("input.editionInput").val(o.substring(9,o.length));a("div.imageContainer").html('<img src="'+q+'" />');a("input.imageURL").attr("value",q);a("input.imageID").attr("value",y);a("span.titlePreview").text(C.substring(7,C.length));a("span.authorPreview").html(z);if(o!=""){a("span.editionPreview").html(p).show()}else{a("span.editionPreview").hide()}var x=new Array();r.each(function(){var D=a(this).text();var E=new Array();E.push(D.substring(0,D.length-6));E.push(D.substring(D.length-5,D.length-2));E.push(D.substring(D.length-1,D.length));x.push(E)});var B=a("section.courseInformationSection");var u=B.children("div.flyoutTemplate").html();var t=B.children("div.sectionTemplate").html();if(r.length>0){B.children("div.classUsed").remove()}for(var s=0;s<=x.length-1;s++){var w=a('<div class="classUsed" />');w.insertAfter(B.children("div:last"));w.append(u);w.append('<div class="inputWrapper"><input autocomplete="off" class="noIcon validate[required,custom[integer],min[101],max[499]]" maxlength="3" name="classNum[]" type="text" value="'+x[s][1]+'" /><div>');w.append(t);w.append('<span class="delete" title="Delete this class"></span>');w.find("div.menuWrapper ul.categoryFly li ul li").each(function(){var D=a(this);if(D.hasClass("selected")){D.removeClass("selected")}if(D.text()==x[s][0]){D.addClass("selected");w.find("div.menuWrapper input").attr("value",D.attr("data-value"))}});w.find("div.dropdownWrapper ul.dropdown li").each(function(){var D=a(this);if(D.hasClass("selected")){D.removeClass("selected")}if(D.text()==x[s][2]){D.addClass("selected");w.find("div.dropdownWrapper input").attr("value",D.text())}})}A.delfini_dialog("close")});a("body").delegate("section.dialog div.buttons button.inAccurate","click",function(){var o=d+a("input.ISBN").val();a(this).parent().parent().delfini_dialog("close");c.text("Guessing...");i=new Array();n.addClass("disabled");l.removeClass("disabled");a.ajax({url:o,dataType:"jsonp",success:function(s){var r=s.items;e=0;if(r&&r!=undefined){for(var q=0;q<=r.length-1;q++){if(r[q].product.images&&r[q].product.images!=undefined){i.push(r[q].product.images[0].link)}}}if((!r&&r==undefined)||(r&&r!=undefined&&r.length==0)){var p=document.location.href.toString().match(/(.*)\/sell-books\//)[1]+"/system/images/icons/default_book.png";c.html('<img src="'+p+'" />');a("input.imageURL").attr("value",p);a("div.imageBrowser").addClass("hidden")}else{c.html('<img src="'+i[0]+'" />');a("input.imageURL").attr("value",i[0]);if(r.length==1){l.addClass("disabled")}a("div.imageBrowser").removeClass("hidden");if(i.length>1){setTimeout(function(){a("div.imageBrowser span.forward").validationEngine("showPrompt","Click on these arrows to browse through the images and find the best looking cover!","pass","topRight",true)},4000)}}}})});l.click(function(){if(!l.hasClass("disabled")&&i[e+1]!=undefined){e++;c.html('<img src="'+i[e]+'" />');b.attr("value",i[e]);if(i[e+1]==undefined){l.addClass("disabled")}n.removeClass("disabled")}});n.click(function(){if(!n.hasClass("disabled")&&i[e-1]!=undefined){e--;c.html('<img src="'+i[e]+'" />');b.attr("value",i[e]);if(i[e-1]==undefined){n.addClass("disabled")}l.removeClass("disabled")}});a("input.titleInput").on("change",function(){var o=a(this);if(o.val()==""){a("span.titlePreview").html("&lt;Book Title&gt;")}else{a("span.titlePreview").text(o.val())}});a("input.authorInput").on("change",function(){var o=a(this);if(o.val()==""){a("span.authorPreview").html("<strong>Author:</strong> &lt;Book Title&gt;")}else{a("span.authorPreview").html("<strong>Author:</strong> "+o.val())}});a("input.editionInput").on("change",function(){var o=a(this);if(o.val()==""){a("span.editionPreview").html("<strong>Edition:</strong> ").hide()}else{a("span.editionPreview").html("<strong>Edition:</strong> "+o.val()).show()}});a("input.priceInput").on("change",function(){var o=a(this);var p=parseInt(o.val().replace(/[^0-9]/g,""));if(o.val()!=""&&p>=0&&p<=99999){a("span.pricePreview span").text("$"+parseFloat(o.val()).toFixed(2));o.attr("value",parseFloat(o.val()).toFixed(2))}else{a("span.pricePreview span").text("$0.00");o.attr("value","0.00")}});a("body").delegate("span.delete","click",function(){if(a("div.classUsed").length>1){a(this).parent().remove()}else{a('<section class="dialog" style="margin: 0px 35% 0px 35%; width: 30%;"><h1>Whoops!</h1><div class="content"><p style="font-size: 16px; margin-top: 5px;">You must have at least one class in this list.</p></div><div class="buttons"><button class="blue close">Ok, thanks</button></div></section>').appendTo("body").delfini_dialog()}});a("body").delegate("button.close","click",function(){a(this).parent().parent().delfini_dialog("close")});a("span.add").click(function(){var o=a("section.courseInformationSection");var p=o.children("div.flyoutTemplate").html();var r=o.children("div.sectionTemplate").html();var q=a('<div class="classUsed" />');q.insertAfter(o.children("div:last"));q.append(p);q.append('<div class="inputWrapper"><input autocomplete="off" class="noIcon validate[required,custom[integer],min[101],max[499]]" maxlength="3" name="classNum[]" type="text" value="" /><div>');q.append(r);q.append('<span class="delete" title="Delete this class"></span>')});a(":text").tooltip({position:"center right",offset:[-2,10],effect:"fade"});a("form").validationEngine({validationEventTrigger:"submit",promptPosition:"topRight",autoHidePrompt:"true",autoHideDelay:7000});a("input.again").click(function(){a("input.redirect").attr("value","1")});a("input.finish").click(function(){a("input.redirect").attr("value","0")});a("input.cancel").click(function(){document.location.href="../"})})})(jQuery);function checkImage(c,d,b,a){if(c.val()==""){return"* You will probably want an image to go with your book"}}function checkISBN(d,e,b,a){var c=d.val().replace(/[^0-9a-zA-Z]/g,"");if(c.length==10||c.length==13){}else{return"* An ISBN will have either 10 or 13 numbers, dashes are okay"}}function checkPrice(e,f,c,b){var d=parseInt(e.val().replace(/[^0-9]/g,""));var a=/^\d+(\.\d{2})?$/;if(d>=0&&d<=99999&&a.test(e.val())){}else{return"* Valid prices range from $0.00 to $999.99"}};
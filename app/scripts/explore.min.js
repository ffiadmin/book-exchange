(function(a){a.fn.FFI_BE_Explore=function(b){a.extend(a.fn.FFI_BE_Explore.defaults,b);return this.each(function(){a.fn.FFI_BE_Explore.input=a(this);a.fn.FFI_BE_Explore.document=a(document);a.fn.FFI_BE_Explore.page=a("html, body");a.fn.FFI_BE_Explore.window=a(window);a.fn.FFI_BE_Explore.container=a.fn.FFI_BE_Explore.input.parent().parent().parent();a.fn.FFI_BE_Explore.section=a.fn.FFI_BE_Explore.container.parent();a.fn.FFI_BE_Explore.searchOptions=a.fn.FFI_BE_Explore.input.parent().siblings("div.options");a.fn.FFI_BE_Explore.by=a.fn.FFI_BE_Explore.searchOptions.find("select.by");a.fn.FFI_BE_Explore.inMenu=a.fn.FFI_BE_Explore.searchOptions.find("select.in");a.fn.FFI_BE_Explore.sortMenu=a.fn.FFI_BE_Explore.searchOptions.find("select.sort");a.fn.FFI_BE_Explore.timer;a.fn.FFI_BE_Explore.removeMask();a.fn.FFI_BE_Explore.searchBar();a.fn.FFI_BE_Explore.eventsInit();a.fn.FFI_BE_Explore.updateInputsFromHash();a("button.close-search").click(function(){a.fn.FFI_BE_Explore.resetSearch()})})};a.fn.FFI_BE_Explore.searchBar=function(){a.fn.FFI_BE_Explore.placeSearchBar();a.fn.FFI_BE_Explore.updateSearchBarPositionOnScroll();a.fn.FFI_BE_Explore.updateSearchBarPositionOnWindowResize()};a.fn.FFI_BE_Explore.eventsInit=function(){a.fn.FFI_BE_Explore.document.keydown(function(c){var b=c.keyCode||c.which;var d=c.shiftKey?String.fromCharCode(c.keyCode).toUpperCase():String.fromCharCode(c.keyCode).toLowerCase();if(b==27){a.fn.FFI_BE_Explore.resetSearch();return}if(b==13){clearTimeout(a.fn.FFI_BE_Explore.timer);a.fn.FFI_BE_Explore.updateHash();return}if(!a.fn.FFI_BE_Explore.input.is(":focus")&&/[a-z0-9]/i.test(d)){a.fn.FFI_BE_Explore.input.focus()}clearTimeout(a.fn.FFI_BE_Explore.timer);a.fn.FFI_BE_Explore.timer=setTimeout(function(){a.fn.FFI_BE_Explore.updateHash()},a.fn.FFI_BE_Explore.defaults.hashUpdateDelay)});a.fn.FFI_BE_Explore.document.keyup(function(b){if(a.fn.FFI_BE_Explore.input.val()==""){a.fn.FFI_BE_Explore.hideControls();a.fn.FFI_BE_Explore.resetSearch()}else{a.fn.FFI_BE_Explore.showControls()}});a.fn.FFI_BE_Explore.input.focus(function(){if(!a.fn.FFI_BE_Explore.searchActive()){a.fn.FFI_BE_Explore.page.animate({scrollTop:a.fn.FFI_BE_Explore.section.offset().top+1},a.fn.FFI_BE_Explore.defaults.windowScrollTime)}});a.fn.FFI_BE_Explore.window.bind("hashchange",function(){a.fn.FFI_BE_Explore.updateInputsFromHash()});a.fn.FFI_BE_Explore.by.change(function(){a.fn.FFI_BE_Explore.updateHash()});a.fn.FFI_BE_Explore.inMenu.change(function(){a.fn.FFI_BE_Explore.updateHash()});a.fn.FFI_BE_Explore.sortMenu.change(function(){a.fn.FFI_BE_Explore.updateHash()})};a.fn.FFI_BE_Explore.removeMask=function(){setTimeout(function(){a("body").addClass("show");setTimeout(function(){a("section.loader").remove()},a.fn.FFI_BE_Explore.defaults.maskRemoveFadeDuration)},a.fn.FFI_BE_Explore.defaults.maskRemoveDelay)};a.fn.FFI_BE_Explore.searchActive=function(){return a.fn.FFI_BE_Explore.section.hasClass("active-search")};a.fn.FFI_BE_Explore.placeSearchBar=function(){a.fn.FFI_BE_Explore.section.css("margin-top",a.fn.FFI_BE_Explore.window.height()-a.fn.FFI_BE_Explore.container.height())};a.fn.FFI_BE_Explore.updateSearchBarPositionOnScroll=function(){a.fn.FFI_BE_Explore.window.scroll(function(){if(a.fn.FFI_BE_Explore.window.scrollTop()>a.fn.FFI_BE_Explore.window.height()-a.fn.FFI_BE_Explore.container.height()){a.fn.FFI_BE_Explore.section.addClass("fixed")}else{a.fn.FFI_BE_Explore.section.removeClass("fixed")}})};a.fn.FFI_BE_Explore.updateSearchBarPositionOnWindowResize=function(){a.fn.FFI_BE_Explore.window.resize(function(){a.fn.FFI_BE_Explore.section.css("margin-top",a.fn.FFI_BE_Explore.window.height()-a.fn.FFI_BE_Explore.container.height())})};a.fn.FFI_BE_Explore.updateHash=function(){var b=a.fn.FFI_BE_Explore.input.val();var c;if(b!=""){c="q="+encodeURIComponent(b)+"&by="+encodeURIComponent(a.fn.FFI_BE_Explore.by.val())+"&in="+encodeURIComponent(a.fn.FFI_BE_Explore.inMenu.val())+"&sort="+encodeURIComponent(a.fn.FFI_BE_Explore.sortMenu.val())}else{c="nop"}window.location.hash=c};a.fn.FFI_BE_Explore.search=function(){var b=a.fn.FFI_BE_Explore.input.val(),c=a.fn.FFI_BE_Explore.by.val();a.ajax({data:{q:b,by:c,"in":a.fn.FFI_BE_Explore.inMenu.val(),sort:a.fn.FFI_BE_Explore.sortMenu.val(),page:"1",limit:a.fn.FFI_BE_Explore.defaults.searchResultsLimit},type:"GET",url:a.fn.FFI_BE_Explore.defaults.searchURL,success:function(f){if(a.fn.FFI_BE_Explore.searchActive()){var h=a.parseJSON(f);var g='<ul class="search-list">';var j=["poor","fair","good","very-good","excellent"];if(h.length){for(var d=0;d<h.length;++d){g+="<li>";g+='<a href="#"><img src="'+h[d].imageURL+'"></a>';g+='<h3><a href="#">'+h[d].title+"</a> <span>by "+h[d].author+"</span></h3>";g+='<p class="merchant"><strong>Merchant:</strong> '+h[d].merchant+"</p>";g+='<p class="condition '+j[h[d].condition-1]+'"><strong>Condition:</strong></p>';g+='<button class="btn btn-primary purchase" data-id="'+h[d].ID+'">Buy for $'+h[d].price+".00</button>";g+="</li>"}}else{g+='<li class="none">';g+="<h3>No Results Found</h3>";g+="<p>We looked hard, but we couldn't find anything related to <strong>"+b+"</strong> when searching by <strong>"+c+"</strong>. Try adjusting your search criteria. However, it's possible that we just don't have anything on <strong>"+b+"</strong>. Bummer. :-(</p>"}g+="</ul>";var e=a("section.search-hotspot");if(!e.length){e=a('<section class="search-hotspot"/>').appendTo(a.fn.FFI_BE_Explore.section)}e.empty().html(g);a("div.loader-mask").remove()}}})};a.fn.FFI_BE_Explore.parseHash=function(){var e=window.location.hash.substring(1);var d=e.split("&");var b=new Array();for(var c=0;c<d.length;c++){var f=d[c].split("=");b.push([f[0],decodeURIComponent(f[1])])}return b};a.fn.FFI_BE_Explore.updateInputsFromHash=function(){var b=a.fn.FFI_BE_Explore.parseHash();if(b[0][1]&&b[0][1]!=undefined&&b[0][1]!="undefined"){a.fn.FFI_BE_Explore.input.val(b[0][1]);a.fn.FFI_BE_Explore.by.val(b[1][1]);a.fn.FFI_BE_Explore.inMenu.val(b[2][1]);a.fn.FFI_BE_Explore.sortMenu.val(b[3][1]);a.fn.FFI_BE_Explore.activateSearch();a.fn.FFI_BE_Explore.showControls();a.fn.FFI_BE_Explore.scrollToSearch();a.fn.FFI_BE_Explore.search()}else{a.fn.FFI_BE_Explore.resetSearch()}};a.fn.FFI_BE_Explore.scrollToSearch=function(b){if(b){a.fn.FFI_BE_Explore.page.animate({scrollTop:a.fn.FFI_BE_Explore.section.offset().top+1},a.fn.FFI_BE_Explore.defaults.windowScrollTime)}else{a.fn.FFI_BE_Explore.page.scrollTop(a.fn.FFI_BE_Explore.section.offset().top+1)}};a.fn.FFI_BE_Explore.showControls=function(){a.fn.FFI_BE_Explore.section.addClass("show-controls")};a.fn.FFI_BE_Explore.hideControls=function(){a.fn.FFI_BE_Explore.section.removeClass("show-controls")};a.fn.FFI_BE_Explore.activateSearch=function(){if(!a.fn.FFI_BE_Explore.searchActive()){a.fn.FFI_BE_Explore.section.addClass("active-search");setTimeout(function(){a("section.liberal-arts, section.science-mathematics").hide()},a.fn.FFI_BE_Explore.adjacentContainersFadeDuration)}else{a('<div class="loader-mask"/>').appendTo(a.fn.FFI_BE_Explore.section)}};a.fn.FFI_BE_Explore.resetSearch=function(){a.fn.FFI_BE_Explore.input.val("");a.fn.FFI_BE_Explore.updateHash();a.fn.FFI_BE_Explore.section.removeClass("active-search show-controls");a("section.liberal-arts, section.science-mathematics").show();a("section.search-hotspot").remove();a("div.loader-mask").remove();clearTimeout(a.fn.FFI_BE_Explore.timer)};a.fn.FFI_BE_Explore.defaults={adjacentContainersFadeDuration:500,hashUpdateDelay:1000,maskRemoveDelay:1500,maskRemoveFadeDuration:250,searchResultsLimit:10,searchURL:document.location.href.substring(0,document.location.href.indexOf("book-exchange"))+"wp-content/plugins/book-exchange/app/includes/ajax/search.php",windowScrollTime:500}})(jQuery);(function(a){a(function(){a("input#search-main").FFI_BE_Explore();a("li.browse").click(function(){a("html, body").animate({scrollTop:a("section.explore").offset().top+1},500)});a("li.search").click(function(){a("input#search-main").focus()})})})(jQuery);
(function(a){a.fn.FFI_BE_Explore=function(b){a.extend(a.fn.FFI_BE_Explore.defaults,b);return this.each(function(){a.fn.FFI_BE_Explore.input=a(this);a.fn.FFI_BE_Explore.document=a(document);a.fn.FFI_BE_Explore.page=a("html, body");a.fn.FFI_BE_Explore.window=a(window);a.fn.FFI_BE_Explore.container=a.fn.FFI_BE_Explore.input.parent().parent().parent();a.fn.FFI_BE_Explore.section=a.fn.FFI_BE_Explore.container.parent();a.fn.FFI_BE_Explore.searchOptions=a.fn.FFI_BE_Explore.input.parent().siblings("div.options");a.fn.FFI_BE_Explore.by=a.fn.FFI_BE_Explore.searchOptions.find("select.by");a.fn.FFI_BE_Explore.inMenu=a.fn.FFI_BE_Explore.searchOptions.find("select.in");a.fn.FFI_BE_Explore.sortMenu=a.fn.FFI_BE_Explore.searchOptions.find("select.sort");a.fn.FFI_BE_Explore.allowPageFetch=false;a.fn.FFI_BE_Explore.currentPage=1;a.fn.FFI_BE_Explore.reachedEnd=false;a.fn.FFI_BE_Explore.scrollTimer;a.fn.FFI_BE_Explore.typeTimer;a.fn.FFI_BE_Explore.removeMask();a.fn.FFI_BE_Explore.searchBar();a.fn.FFI_BE_Explore.eventsInit();a.fn.FFI_BE_Explore.updateInputsFromHash();a.fn.FFI_BE_Explore.document.on("click","button.close-search",function(){a.fn.FFI_BE_Explore.resetSearch()})})};a.fn.FFI_BE_Explore.searchBar=function(){a.fn.FFI_BE_Explore.section.css("margin-top",a.fn.FFI_BE_Explore.window.height()-a.fn.FFI_BE_Explore.container.height());a.fn.FFI_BE_Explore.window.scroll(function(){if(a.fn.FFI_BE_Explore.window.scrollTop()>a.fn.FFI_BE_Explore.window.height()-a.fn.FFI_BE_Explore.container.height()){a.fn.FFI_BE_Explore.section.addClass("fixed")}else{a.fn.FFI_BE_Explore.section.removeClass("fixed")}});a.fn.FFI_BE_Explore.window.resize(function(){a.fn.FFI_BE_Explore.section.css("margin-top",a.fn.FFI_BE_Explore.window.height()-a.fn.FFI_BE_Explore.container.height())})};a.fn.FFI_BE_Explore.eventsInit=function(){a.fn.FFI_BE_Explore.document.keydown(function(c){var b=c.keyCode||c.which;var d=c.shiftKey?String.fromCharCode(c.keyCode).toUpperCase():String.fromCharCode(c.keyCode).toLowerCase();if(b==27){a.fn.FFI_BE_Explore.resetSearch();return}if(b==13){clearTimeout(a.fn.FFI_BE_Explore.typeTimer);a.fn.FFI_BE_Explore.updateHash();return}if(!a("input:focus, textarea:focus").length&&/[a-z0-9]/i.test(d)){a.fn.FFI_BE_Explore.input.focus()}clearTimeout(a.fn.FFI_BE_Explore.typeTimer);a.fn.FFI_BE_Explore.typeTimer=setTimeout(function(){a.fn.FFI_BE_Explore.updateHash()},a.fn.FFI_BE_Explore.defaults.hashUpdateDelay)});a.fn.FFI_BE_Explore.document.keyup(function(b){if(a.fn.FFI_BE_Explore.input.val()==""){a.fn.FFI_BE_Explore.hideControls();a.fn.FFI_BE_Explore.resetSearch()}else{a.fn.FFI_BE_Explore.showControls()}});a.fn.FFI_BE_Explore.input.focus(function(){if(!a.fn.FFI_BE_Explore.searchActive()){a.fn.FFI_BE_Explore.page.animate({scrollTop:a.fn.FFI_BE_Explore.section.offset().top+1},a.fn.FFI_BE_Explore.defaults.windowScrollTime)}});a.fn.FFI_BE_Explore.window.bind("hashchange",function(){a.fn.FFI_BE_Explore.updateInputsFromHash()});a.fn.FFI_BE_Explore.by.change(function(){a.fn.FFI_BE_Explore.updateHash()});a.fn.FFI_BE_Explore.inMenu.change(function(){a.fn.FFI_BE_Explore.updateHash()});a.fn.FFI_BE_Explore.sortMenu.change(function(){a.fn.FFI_BE_Explore.updateHash()});a.fn.FFI_BE_Explore.window.scroll(function(){a.fn.FFI_BE_Explore.nextPage()})};a.fn.FFI_BE_Explore.removeMask=function(){setTimeout(function(){a("body").addClass("show");setTimeout(function(){a("section.loader").remove()},a.fn.FFI_BE_Explore.defaults.maskRemoveFadeDuration)},a.fn.FFI_BE_Explore.defaults.maskRemoveDelay)};a.fn.FFI_BE_Explore.endVisible=function(){var c=a("span#end");if(a.fn.FFI_BE_Explore.searchActive()&&c.length){var f=a.fn.FFI_BE_Explore.window.scrollTop();var d=f+a.fn.FFI_BE_Explore.window.height();var e=c.offset().top;var b=e+c.height();return((b<=d)&&(e>=f))}return false};a.fn.FFI_BE_Explore.searchActive=function(){return a.fn.FFI_BE_Explore.section.hasClass("active-search")};a.fn.FFI_BE_Explore.updateHash=function(){var b=a.fn.FFI_BE_Explore.input.val();var c;if(b!=""){c="q="+encodeURIComponent(b)+"&by="+encodeURIComponent(a.fn.FFI_BE_Explore.by.val())+"&in="+encodeURIComponent(a.fn.FFI_BE_Explore.inMenu.val())+"&sort="+encodeURIComponent(a.fn.FFI_BE_Explore.sortMenu.val())}else{c="nop"}window.location.hash=c};a.fn.FFI_BE_Explore.search=function(){var b=a.fn.FFI_BE_Explore.input.val(),c=a.fn.FFI_BE_Explore.by.val();a.fn.FFI_BE_Explore.allowPageFetch=false;a.fn.FFI_BE_Explore.currentPage=1;a.fn.FFI_BE_Explore.reachedEnd=false;a.ajax({data:{q:b,by:c,"in":a.fn.FFI_BE_Explore.inMenu.val(),sort:a.fn.FFI_BE_Explore.sortMenu.val(),page:a.fn.FFI_BE_Explore.currentPage,limit:a.fn.FFI_BE_Explore.defaults.searchResultsLimit},type:"GET",url:a.fn.FFI_BE_Explore.defaults.searchURL,success:function(g){if(a.fn.FFI_BE_Explore.searchActive()){try{var k=a.parseJSON(g)}catch(h){if(g==""){a.fn.FFI_BE_Explore.reachedEnd=true}else{if(g.substring(0,10)=="USER_ERROR"){alert(g.substring(10))}else{alert("An error was encountered while processing your search request.\n\nIf this is the first time you have seen this error, wait one minute and try reloading this page before performing another search. If this error continues to occur, contact the site administrator for assistance and include the details listed below.\n\n-----------------------\n\nQuery string:\n"+window.location.hash.substring(1)+"\n\nResponse from server:\n"+g)}}return}var j='<ul class="book-list search-list">';if(k.length){j+="</ul>";j+='<span id="end"></span>'}else{j+='<li class="none">';j+="<h3>No Results Found</h3>";j+="<p>We looked hard, but we couldn't find anything related to <strong>"+b+"</strong> when searching by <strong>"+c+"</strong>. Try adjusting your search criteria. However, it's possible that we just don't have anything on <strong>"+b+"</strong>. Bummer. :-(</p>";j+='<button class="btn btn-primary close-search">Close Search</button>';j+="</li>";j+="</ul>"}var f=a("section.search-hotspot");if(!f.length){f=a('<section class="content search-hotspot"/>').appendTo(a.fn.FFI_BE_Explore.section)}f.empty().html(j);if(k.length){for(var d=0;d<k.length;++d){a.fn.FFI_BE_Explore.addSearchResult(k[d].ID,k[d].title,k[d].author,k[d].condition,k[d].price,k[d].imageURL)}}a("div.loader-mask").remove();if(k.length<a.fn.FFI_BE_Explore.defaults.searchResultsLimit){a.fn.FFI_BE_Explore.reachedEnd=true}else{setTimeout(function(){a.fn.FFI_BE_Explore.allowPageFetch=true;a.fn.FFI_BE_Explore.nextPage()},a.fn.FFI_BE_Explore.defaults.nextPageFetchDelay)}}}})};a.fn.FFI_BE_Explore.parseHash=function(){var e=window.location.hash.substring(1);var d=e.split("&");var b=new Array();for(var c=0;c<d.length;c++){var f=d[c].split("=");b.push([f[0],decodeURIComponent(f[1])])}return b};a.fn.FFI_BE_Explore.generateURL=function(c,d){var b=document.location.href.substring(0,document.location.href.indexOf("book-exchange"))+"book-exchange/book/";b+=c+"/";b+=d.replace(/[^A-Za-z0-9\s]/g,"").replace(/[\s]/g,"-").toLowerCase()+"/";return b};a.fn.FFI_BE_Explore.addSearchResult=function(g,i,e,b,f,c){var j=["poor","fair","good","very-good","excellent"];var h=a.fn.FFI_BE_Explore.generateURL(g,i);var d="<li>";d+='<a href="'+h+'"><img src="'+c+'"></a>';d+="<div>";d+='<a href="'+h+'"><h3>'+i+"</h3></a>";d+='<a href="'+h+'"><h4>by '+e+"</h4></a>";d+='<p class="condition '+j[b-1]+'"><strong>Condition:</strong></p>';d+='<p class="price">$'+f+".00</p>";d+='<button class="btn btn-primary purchase" data-id="'+g+'" data-title="'+a.fn.FFI_BE_Explore.htmlEntities(i)+'" data-author="'+a.fn.FFI_BE_Explore.htmlEntities(e)+'" data-image="'+a.fn.FFI_BE_Explore.htmlEntities(c)+'" data-price="'+f+'"><span class="large">Buy for </span>$'+f+".00</button>";d+="</div>";d+="</li>";a("ul.search-list").append(d)};a.fn.FFI_BE_Explore.htmlEntities=function(b){return a("<div/>").text(b).html()};a.fn.FFI_BE_Explore.nextPage=function(){if(a.fn.FFI_BE_Explore.endVisible()&&a.fn.FFI_BE_Explore.allowPageFetch&&!a.fn.FFI_BE_Explore.reachedEnd){a.fn.FFI_BE_Explore.allowPageFetch=false;a.ajax({data:{q:a.fn.FFI_BE_Explore.input.val(),by:a.fn.FFI_BE_Explore.by.val(),"in":a.fn.FFI_BE_Explore.inMenu.val(),sort:a.fn.FFI_BE_Explore.sortMenu.val(),page:++a.fn.FFI_BE_Explore.currentPage,limit:a.fn.FFI_BE_Explore.defaults.searchResultsLimit},type:"GET",url:a.fn.FFI_BE_Explore.defaults.searchURL,success:function(c){if(a.fn.FFI_BE_Explore.searchActive()){try{var f=a.parseJSON(c)}catch(d){if(c==""){a.fn.FFI_BE_Explore.reachedEnd=true}else{if(c.substring(0,10)=="USER_ERROR"){alert(c.substring(10))}else{alert("An error was encountered while processing your search request.\n\nIf this is the first time you have seen this error, wait one minute and try reloading this page before performing another search. If this error continues to occur, contact the site administrator for assistance and include the details listed below.\n\n-----------------------\n\nQuery string:\n"+window.location.hash.substring(1)+"\n\nResponse from server:\n"+c)}}return}if(f.length){for(var b=0;b<f.length;++b){a.fn.FFI_BE_Explore.addSearchResult(f[b].ID,f[b].title,f[b].author,f[b].condition,f[b].price,f[b].imageURL)}}if(f.length<a.fn.FFI_BE_Explore.defaults.searchResultsLimit){a.fn.FFI_BE_Explore.reachedEnd=true}else{setTimeout(function(){a.fn.FFI_BE_Explore.allowPageFetch=true},a.fn.FFI_BE_Explore.defaults.nextPageFetchDelay)}}}})}};a.fn.FFI_BE_Explore.updateInputsFromHash=function(){var b=a.fn.FFI_BE_Explore.parseHash();if(b[0][1]&&b[0][1]!=undefined&&b[0][1]!="undefined"){a.fn.FFI_BE_Explore.input.val(b[0][1]);a.fn.FFI_BE_Explore.by.val(b[1][1]);a.fn.FFI_BE_Explore.inMenu.val(b[2][1]);a.fn.FFI_BE_Explore.sortMenu.val(b[3][1]);a.fn.FFI_BE_Explore.activateSearch();a.fn.FFI_BE_Explore.showControls();a.fn.FFI_BE_Explore.scrollToSearch();a.fn.FFI_BE_Explore.search()}else{a.fn.FFI_BE_Explore.resetSearch()}};a.fn.FFI_BE_Explore.scrollToSearch=function(b){if(b){a.fn.FFI_BE_Explore.page.animate({scrollTop:a.fn.FFI_BE_Explore.section.offset().top+1},a.fn.FFI_BE_Explore.defaults.windowScrollTime)}else{a.fn.FFI_BE_Explore.page.scrollTop(a.fn.FFI_BE_Explore.section.offset().top+1)}};a.fn.FFI_BE_Explore.showControls=function(){a.fn.FFI_BE_Explore.section.addClass("show-controls")};a.fn.FFI_BE_Explore.hideControls=function(){a.fn.FFI_BE_Explore.section.removeClass("show-controls")};a.fn.FFI_BE_Explore.activateSearch=function(){if(!a.fn.FFI_BE_Explore.searchActive()){a.fn.FFI_BE_Explore.section.addClass("active-search");setTimeout(function(){a("section.liberal-arts, section.science-mathematics").hide()},a.fn.FFI_BE_Explore.adjacentContainersFadeDuration)}else{if(!a("div.loader-mask").length){a('<div class="loader-mask"/>').appendTo(a.fn.FFI_BE_Explore.section)}}};a.fn.FFI_BE_Explore.resetSearch=function(){a.fn.FFI_BE_Explore.input.val("");a.fn.FFI_BE_Explore.updateHash();a.fn.FFI_BE_Explore.section.removeClass("active-search show-controls");a("section.liberal-arts, section.science-mathematics").show();a("section.search-hotspot").remove();a("div.loader-mask").remove();clearTimeout(a.fn.FFI_BE_Explore.typeTimer)};a.fn.FFI_BE_Explore.defaults={adjacentContainersFadeDuration:500,hashUpdateDelay:1000,maskRemoveDelay:1500,maskRemoveFadeDuration:250,nextPageFetchDelay:1000,searchResultsLimit:10,searchURL:document.location.href.substring(0,document.location.href.indexOf("book-exchange"))+"wp-content/plugins/book-exchange/app/includes/ajax/search.php",windowScrollTime:500}})(jQuery);(function(a){a(function(){var b=a("input#search-main").FFI_BE_Explore();a("li.browse").click(function(){b.FFI_BE_Explore.resetSearch();b.FFI_BE_Explore.scrollToSearch(true)});a("li.search").click(function(){a("input#search-main").focus();b.FFI_BE_Explore.scrollToSearch(true)})})})(jQuery);
